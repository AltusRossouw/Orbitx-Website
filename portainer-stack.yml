# Portainer Stack Configuration for OrbitX Website
# Use this configuration in Portainer to deploy from Docker Hub

version: "3.8"

services:
  orbitx-website:
    # Use the Docker Hub image we just built
    image: altusrossouw/orbitx-website:latest
    container_name: orbitx-website
    
    # Port mapping
    ports:
      - "3330:3000"
    
    # Environment variables
    environment:
      # Basic Next.js configuration
      - NODE_ENV=production
      - NEXT_TELEMETRY_DISABLED=1
      - PORT=3000
      - HOSTNAME=0.0.0.0
      
      # Umami Analytics Configuration
      - NEXT_PUBLIC_UMAMI_WEBSITE_ID=1bcbdb6f-8263-4ef0-8a49-340172b88292
      - NEXT_PUBLIC_UMAMI_SRC=https://umami.intellixlabs.co.za/script.js
    
    # Health check
    healthcheck:
      test: ["CMD-SHELL", "curl -fsS http://localhost:3000/api/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    
    # Restart policy
    restart: unless-stopped
    
    # Resource limits (adjust as needed)
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1G
        reservations:
          cpus: "0.5"
          memory: 512M
    
    # Labels for organization
    labels:
      - "app=orbitx-website"
      - "environment=production"
      - "com.centurylinklabs.watchtower.enable=true"
      - "description=OrbitX Direct Drive LED Lighting Website"